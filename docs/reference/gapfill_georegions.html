<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Gapfill using georegional means — gapfill_georegions • OHICORE</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="Gapfill using georegional means — gapfill_georegions" />

<meta property="og:description" content="Gapfill using georegional means, providing the finest possible resolution from 3 hierarchies (r2 &amp;gt; r1 &amp;gt; r0) derived from United Nations geoscheme." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OHICORE</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/introduction.html">
    <span class="fa fa-play-circle"></span>
     
    Introduction
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dataprep.html">Data for the Toolbox</a>
    </li>
    <li>
      <a href="../articles/ecosystem.html">Toolbox Ecosystem</a>
    </li>
    <li>
      <a href="../articles/workflow.html">Workflow</a>
    </li>
    <li>
      <a href="../articles/reporting.html">Reporting</a>
    </li>
    <li>
      <a href="../articles/functionsR.html">functions.R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    Changelog
  </a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../articles/faq.html">
    <span class="fa fa-question-circle-o"></span>
     
    FAQ
  </a>
</li>
<li>
  <a href="https://github.com/OHI-Science/ohicore">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Gapfill using georegional means</h1>
    <small class="dont-index">Source: <a href='https://github.com/OHI-Science/ohicore/blob/master/R/gapfill_georegions.R'><code>R/gapfill_georegions.R</code></a></small>
    <div class="hidden name"><code>gapfill_georegions.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Gapfill using georegional means, providing the finest possible resolution from 3 hierarchies (r2 &gt; r1 &gt; r0) derived from <a href='http://en.wikipedia.org/wiki/United_Nations_geoscheme'>United Nations geoscheme</a>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>gapfill_georegions</span>(<span class='no'>data</span>, <span class='no'>georegions</span>, <span class='kw'>fld_id</span> <span class='kw'>=</span> <span class='fu'>intersect</span>(<span class='fu'>names</span>(<span class='no'>data</span>),
  <span class='fu'>names</span>(<span class='no'>georegions</span>)), <span class='kw'>fld_year</span> <span class='kw'>=</span> <span class='fu'>ifelse</span>(<span class='st'>"year"</span> <span class='kw'>%in%</span> <span class='fu'>names</span>(<span class='no'>data</span>), <span class='st'>"year"</span>,
  <span class='fl'>NA</span>), <span class='kw'>fld_value</span> <span class='kw'>=</span> <span class='fu'>setdiff</span>(<span class='fu'>names</span>(<span class='no'>data</span>), <span class='fu'>c</span>(<span class='no'>fld_id</span>, <span class='no'>fld_weight</span>, <span class='st'>"year"</span>)),
  <span class='kw'>georegion_labels</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>fld_weight</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>rgn_weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>ratio_weights</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>gapfill_scoring_weights</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='kw'>r0</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>r1</span> <span class='kw'>=</span> <span class='fl'>0.8</span>, <span class='kw'>r2</span> <span class='kw'>=</span>
  <span class='fl'>0.5</span>, <span class='kw'>v</span> <span class='kw'>=</span> <span class='fl'>0</span>), <span class='kw'>r0_to_NA</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>attributes_csv</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>data.frame to gapfill having at least fields: <code>fld_id</code> and <code>fld_value</code>, and optionally <code>fld_weight</code></p></td>
    </tr>
    <tr>
      <th>georegions</th>
      <td><p>data.frame having at least fields: <code>fld_id</code> and <code>r0</code>, <code>r1</code>, and <code>r2</code> with georegion id values</p></td>
    </tr>
    <tr>
      <th>fld_id</th>
      <td><p>common spatial id field (eg region_id or country_key) between <code>data</code> and <code>georegions</code></p></td>
    </tr>
    <tr>
      <th>fld_year</th>
      <td><p>optional year field in <code>data</code></p></td>
    </tr>
    <tr>
      <th>fld_value</th>
      <td><p>value to gapfill in <code>data</code></p></td>
    </tr>
    <tr>
      <th>georegion_labels</th>
      <td><p>with same dimensions as georegions having fields: <code>r0_label</code>, <code>r1_label</code>, <code>r2_label</code> and <code>v_label</code></p></td>
    </tr>
    <tr>
      <th>fld_weight</th>
      <td><p>optional weighting field in <code>data</code></p></td>
    </tr>
    <tr>
      <th>rgn_weights</th>
      <td><p>data frame of weights, expecting rgn_id in first column and weight in second</p></td>
    </tr>
    <tr>
      <th>ratio_weights</th>
      <td><p>if TRUE, multiply the gapfilled value by the ratio of the region's weight to the regional average weight. Defaults to FALSE. IMPORTANT to set to TRUE if dealing with values that SUM!</p></td>
    </tr>
    <tr>
      <th>gapfill_scoring_weights</th>
      <td><p>used to determine gapfilling scoreset. should range 0 to 1. defaults to <code>c('r0'=1, 'r1'=0.8, 'r2'=0.5, 'v'=0)</code></p></td>
    </tr>
    <tr>
      <th>r0_to_NA</th>
      <td><p>assign value of NA if only georegional average availabe at the global level (r0). defaults to True.</p></td>
    </tr>
    <tr>
      <th>attributes_csv</th>
      <td><p>optional path and filename to save attribute table. defaults to NULL</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns a data.frame of having all the <code>fld_id</code> from georegions filled in the following columns:</p><ul>
<li><p><code>fld_id</code> - spatial id (eg region_id or country_key).</p></li>
<li><p><code>fld_value</code> - the gapfilled value (eg score).</p></li>
</ul><p>The returned data.frame also has an attribute "gapfill_georegions" which shows the calculated georegional means and which levels were chosen:</p><ul>
<li><p><code>r0</code> - georegional id for level 0, ie global.</p></li>
<li><p><code>r1</code> - georegional id for level 1.</p></li>
<li><p><code>r2</code> - georegional id for level 2, the finest resolution of georegions.</p></li>
<li><p><code>id</code> - spatial id (eg region_id or country_key).</p></li>
<li><p><code>w</code> - weight used to apply <code>weighted.mean</code>. Defaults to 1 if not supplied as <code>fld_weight</code> parameter.</p></li>
<li><p><code>v</code> - original <code>fld_value</code> in <code>data</code></p></li>
<li><p><code>r2_v</code> - weighted.mean for level 2</p></li>
<li><p><code>r1_v</code> - weighted.mean for level 1</p></li>
<li><p><code>r0_v</code> - weighted.mean for level 0 (global)</p></li>
<li><p><code>r2_n</code> - count of regions available for level 2</p></li>
<li><p><code>r1_n</code> - count of regions available for level 1</p></li>
<li><p><code>r0_n</code> - count of regions available for level 0</p></li>
<li><p><code>r2_n_notna</code> - count of region values that are not NA for level 2</p></li>
<li><p><code>r1_n_notna</code> - count of region values that are not NA for level 1</p></li>
<li><p><code>r0_n_notna</code> - count of region values that are not NA for level 0</p></li>
<li><p><code>z_level</code> - finest level available</p></li>
<li><p><code>z_ids</code> - ids for regions that are not NA which contributed to the score</p></li>
<li><p><code>z_n</code> - count of input values for finest level available</p></li>
<li><p><code>z_n_pct</code> - percent of region values that are not NA over all possible [0 to 1]</p></li>
<li><p><code>z_g_score</code> - gapfilling score (see details)</p></li>
<li><p><code>z</code> - weighted.mean for finest level available</p></li>
</ul>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Gapfill using georegional means, providing the finest possible resolution from 3 hierarchies (r2 &gt; r1 &gt; r0).</p>
<p>The gapfill score (z_g_score) in the attribute table is formulated such that the higher the score, the 
more gapfilling performed. The maximal gapfill score is based on gapfilling at the global level (r0=1) and least
if no gapfilling performed (ie z = v). But then some regional averages are applied with only a few regional values 
while others might have all but the gapfilled region available. To account for this aspect, the difference between the next
finer level's weight is multiplied by the percent regions and subtracted from the level's weight, like so:</p>
<p><code>gapfill_scoring_weights[z_level] - z_n_pct * diff(gapfill_scoring_weights[z_level, z_level_finer])</code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'>## setup</span>
<span class='fu'>require</span>(<span class='no'>ohicore</span>)

<span class='co'># gapfill</span>
<span class='no'>g</span> <span class='kw'>=</span> <span class='fu'>gapfill_georegions</span>(<span class='no'>data</span>, <span class='no'>georegions</span>, <span class='kw'>fld_weight</span><span class='kw'>=</span><span class='st'>'w_sum'</span>)

<span class='co'># show result and table</span>
<span class='fu'>head</span>(<span class='no'>g</span>)
<span class='fu'>head</span>(<span class='fu'>attr</span>(<span class='no'>g</span>, <span class='st'>'gapfill_georegions'</span>))
<span class='co'># }</span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Melanie Frazier, Ben Best, Julia Stewart Lowndes, Casey O'Hara, Ning Jiang Mendes, Jamie Afflerbach, Steve Hastings, Darren Hardy.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

